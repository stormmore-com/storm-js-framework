function $(...e){if(!(this instanceof $)){if(e[0]instanceof Array&&1===e.length){for(let t of e[0])$.add(t);return}let t=e[0],n=t.name;if(void 0!==$.components[n])return $.new(...e);$.add(t)}}function Component(e){this.templateName=e}$.mode="prod",$.plugins=[],$.components={},$.getCookie=function(e){let t=e+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let r=n[e];for(;" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return null},$.getFromOptional=function(e,t,n){return null!=t&&void 0!==t[e]?t[e]:n},$.app=function(){const e=StormComponentFinder.find();StormComponentInstantiator.instantiateAll(e)},$.addPlugin=function(e){this.plugins.push(e)},$.new=function(...e){let t=e[0];if(t instanceof Function&&(t=t.name),this.components[t])try{let n=new StormComponent;return n=new Proxy(n,n),e.shift(),e.unshift(n),new $.components[t](...e),n.templateName=t,n.componentName=t,n}catch(e){return console.error(`Can't instantiate component '${name}'.`),null}else console.error("Component '"+t+"' not found!. Did you forget to register it ?")},$.newWithElement=function(e,t){if(!this.components[e])return void console.error("Component '"+e+"' not found!. Did you forget to register it ?");let n=new StormComponent;return n.element=t,n=new Proxy(n,n),new $.components[e](n),n.templateName=e,n.componentName=e,n},$.add=function(e){let t=e.name;$.components[t]=e},document.addEventListener("DOMContentLoaded",function(){$(Component),$.app()});class StormBindings{bindings=[];onChangeListeners={};constructor(e){this.component=e}on(e,t){this.onChangeListeners[e]||(this.onChangeListeners[e]=[]),this.onChangeListeners[e].push(t)}bind(){this.bindElements(this.component.element.ori)}bindElements(e){for(const t of e.childNodes)if(t.nodeType===Node.TEXT_NODE){let e=t.textContent;for(const n of this.getProps(e))this.bindings.push({propName:n,element:t,text:t.textContent+""});for(const t of this.getProps(e))this.componentPropertyChanged(t)}else if(t.nodeType===Node.ELEMENT_NODE)if("INPUT"===t.tagName||"TEXTAREA"===t.tagName){let e=t.value,n=this.getProps(e);if(1===n.length){let e=n[0];this.bindings.push({propName:e,element:t,text:t.value}),t.value=this.component[e],t.addEventListener("input",()=>{this.component[e]=t.value,this.componentPropertyChanged(e)})}}else this.bindElements(t)}getProps(e){let t=new RegExp("{{s*(.*?)s*}}","g");return[...e.matchAll(t)].map(e=>e[1]).map(e=>e.trim())}componentPropertyChanged(e){Array.from(this.bindings).filter(t=>t.propName===e).forEach(e=>{let t=e.text,n=this.getProps(e.text);for(let e of n){let n=new RegExp("{{\\s*"+e+"\\s*}}","g");t=t.replace(n,this.component[e])}"INPUT"===e.element.tagName||"TEXTAREA"===e.element.tagName?e.element.value=t:e.element.textContent=t}),this.onChangeListeners[e]&&Array.from(this.onChangeListeners[e]).forEach(t=>{t(e,this.component[e])})}}class StormComponent{static eventBindings={};bindings;componentName;templateName;constructor(e,t){this.componentName=e,this.templateName=t,this.bindings=new StormBindings(this)}set(e,t,n,r){let i=Reflect.set(...arguments);return this[t]=n,this.bindings.componentPropertyChanged(t),i}get(e,t,n){return Reflect.get(e,t,n)}setElement(e){this.element=e instanceof StormElement?e:new StormElement(e),this.bindings.bind()}isOnViewport(){const e=this.element.ori.getBoundingClientRect().top;return e>=0&&e<=window.innerHeight}onViewport(e){null==this._viewPortEvent&&(this._viewPortEvent={triggered:!1,stop(){this.triggered=!0},resume(){this.triggered=!1}}),this.isOnViewport()&&!this._viewPortEvent.triggered&&e(this._viewPortEvent),window.addEventListener("scroll",()=>{this.isOnViewport()&&!this._viewPortEvent.triggered&&e(this._viewPortEvent)})}scrollToHash(){location.hash&&this.scrollToId(location.hash.replace("#",""))}scrollToId(e){const t=document.getElementById(e);null!=t&&window.scrollTo(0,t.getBoundingClientRect().top)}onScroll(e,t=0){window.addEventListener("scroll",n=>{t>0?(this._onScrollTimeout&&clearTimeout(this._onScrollTimeout),this._onScrollTimeout=setTimeout(e,t)):e(n)})}onScrollEnd(e,t=50){null==this._scrollEndEvent&&(this._scrollEndEvent={notify:!0,stop(){this.notify=!1},resume(){this.notify=!0}}),window.addEventListener("scroll",()=>{window.innerHeight+window.scrollY>=document.body.scrollHeight-t&&this._scrollEndEvent.notify&&e(this._scrollEndEvent)})}reload(){location.reload()}exist(e){return null!=this.find(e)}findAll(e){return StormComponentFinder.findAttributes(this.element,e)}document(){return new StormElement(document)}find(e){return this.element.find(e)}remove(){this.element.ori.remove()}submit(e=null){return null==e&&(e=this.getFormData()),fetch(e.action,{method:e.method,body:e.data})}emit(e,t){if(StormComponent.eventBindings[e])for(let n of StormComponent.eventBindings[e])n(t)}on(e,t){StormComponent.eventBindings.hasOwnProperty(e)||(StormComponent.eventBindings[e]=[]),StormComponent.eventBindings[e].push(t)}removeChildren(){this.element.ori.innerHTML=""}appendHtml(e){this.element.appendHtml(e)}append(e){this.appendTo(this.element.ori,e)}appendTo(e,t){if(t.template){let n=document.createElement("template");n.innerHTML=t.template.trim(),n=n.content.firstElementChild,t.setElement(n),Mounter.mount(t),e.append(t.element.ori)}else{const n=t.templateName;this.loadTemplateDocFragment(n).then(n=>{t.setElement(n),Mounter.mount(t),e.append(t.element.ori)}).catch(e=>{console.error(e)})}}showTemplate(){let e=this.element.find("template");if(e){let t=new StormElement(e.ori.content.cloneNode(!0));this.removeChildren(),Mounter.mountComponentElement(this,t),this.element.ori.append(t.ori),this.bindings.bind()}}loadTemplateDocFragment(e){return new Promise((t,n)=>{const r=document.querySelector("[x-for="+e+"]");null==r&&n(`Template '${e}' not found.`);r.content.cloneNode(!0);if(1===r.content.children.length)t(r.content.children[0].cloneNode(!0));else{const e=document.createElement("div");for(let t of r.content.children)e.appendChild(t.cloneNode(!0));t(e)}})}}class StormComponentFinder{static find(e=null){let t=e;null==t&&(t=document.body),null!=e&&null!=e.element&&null!=e.element.ori&&(t=e.element.ori),e instanceof StormElement&&(t=e.ori);let n=Array.from(t.querySelectorAll("*")).filter(e=>e.tagName.toLowerCase().startsWith("x-")).filter(e=>{let n=this.closestStormComponent(e);return(null==n||n==t)&&null==e.closest("template")});return Array.from(n,e=>new StormElement(e))}static findAttributes(e,t="*"){let n=Array.from(e.ori.querySelectorAll(t)).filter(e=>this.#e(e)).filter(t=>{const n=this.closestStormComponent(t);return(null==n||n==e.ori)&&null==t.closest("template")});return this.#e(e.ori)&&n.push(e.ori),Array.from(n,e=>new StormElement(e))}static#e(e){return null!=e.attributes&&Array.from(e.attributes).filter(({name:e})=>e.startsWith("x-")).length}static closestStormComponent(e){let t=e.parentElement;for(;t;){if(t.tagName.toLowerCase().startsWith("x-"))return t;t=t.parentElement}return null}}class StormComponentInstantiator{static instantiateAll(e){for(let t of e){const e=this.instantiate(t);Mounter.mount(e)}}static instantiateChildComponent(e,t){for(let n of t){let t,r=e[StormComponentName.getComponentPropertyName(n)];r?(t=r,t.element=n):t=this.instantiate(n),Mounter.mount(t)}}static instantiate(e){let t=StormComponentName.getComponentName(e),n=$.newWithElement(t,e),r=e.getAttribute("x-init");if(r){let t=JSON.parse(r);for(let[e,r]of Object.entries(t))n[e]=r;e.removeAttribute("x-init")}return n.setElement(e),n}}class StormComponentName{static getComponentName(e){let t=e.ori.tagName.toLowerCase().split("-").slice(1);return t.forEach((e,n)=>{t[n]=t[n].charAt(0).toUpperCase()+t[n].slice(1)}),t.join("")}static getComponentPropertyName(e){let t=this.getComponentName(e);return t.charAt(0).toLowerCase()+t.slice(1)}static getComponentTagName(e){let t=e.constructor.name,n="";for(let e=0;e<t.length;e++)t.charAt(e)===t.charAt(e).toUpperCase()?(e>0&&(n+="-"),n+=t.charAt(e).toLowerCase()):n+=t.charAt(e);return n}static getTagName(e){return"x-"+this.getComponentTagName(e)}}class StormElement{constructor(e){this.ori=e}id(){return this.ori.id}href(){return this.is("a")?this.ori.getAttribute("href"):this.ori.getAttribute("x-href")}redirect(){window.location=this.href()}disable(){this.ori.disabled=!0}enable(){this.ori.disabled=!1}hasAttribute(e){return this.ori.hasAttribute(e)}getAttribute(e){return this.ori.getAttribute(e)}setAttribute(e,t){"checked"===e.toLowerCase()?this.ori.checked=!0===t:this.ori.setAttribute(e,t)}removeAttribute(e){return this.ori.removeAttribute(e)}addClass(e){return this.ori.classList.add(e),this}hasClass(e){return this.ori.classList.contains(e)}removeClass(e){return this.ori.classList.remove(e),this}on(e,t){this.addEventListener(e,t)}addEventListener(e,t){return this.ori.addEventListener(e,e=>{t(new StormEvent(e),this)}),this}addEventListenerOn(e,t,n){const r=this.find(t);return null==r||r.addEventListener(e,n),this}addEventListenerOnAll(e,t,n){return this.findAll(t).forEach(t=>{t.addEventListener(e,n)}),this}loaded(e){return this.ori.complete?e():this.addEventListener("load",e),this}focus(){return this.ori.focus(),this}isFocused(){return this.ori==document.activeElement}setEditable(e){this.ori.contentEditable=e}scrollCenter(){return this.ori.scrollIntoView({block:"center"}),this}scrollTop(e=0){const t=this.ori.offsetTop;return window.scrollTo(0,t+e),this}removeStyleProperty(e){this.ori.style.removeProperty(e)}setMinWidth(e,t="px"){this.ori.style.minWidth=e+t}setWidth(e,t="px"){return this.ori.style.width=e+t,this}setMinHeight(e,t="px"){this.ori.style.minHeight=e+t}setHeight(e,t="px"){return this.ori.style.height=e+t,this}setHeightToScroll(){this.ori.style.height="auto",this.ori.style.height=this.ori.scrollHeight+"px"}submit(){this.ori.submit()}getWidth(){return this.ori.offsetWidth}getHeight(){return this.ori.offsetHeight}getScrollHeight(){return this.ori.scrollHeight}show(e=!0){return e?this.ori.style.removeProperty("display"):this.hide(),this}hide(){this.ori.style.display="none"}formData(){return new FormData(this.ori)}getAction(){return this.ori.getAttribute("action")}getMethod(){return this.ori.getAttribute("method")}serialize(){return{action:this.getAction(),method:this.getMethod(),data:this.formData()}}clear(){const e=this.ori.tagName.toLowerCase();return"input"!==e&&"textarea"!==e||(this.ori.value=""),"img"===e?this.ori.setAttribute("src",""):this.ori.innerHTML="",this}setValue(e){const t=this.ori.tagName.toLowerCase();return"input"!==t&&"textarea"!==t||(this.ori.value=e),"img"===t?this.ori.setAttribute("src",e):this.ori.innerText=e,this}getValue(){const e=this.ori.tagName.toLowerCase();return"input"===e||"textarea"===e?this.ori.value:"img"===e?this.ori.getAttribute("src"):this.ori.innerText.trim()}is(e){if("string"==typeof e&&this.ori.tagName.toLowerCase()===e.toLowerCase())return!0}isCheckbox(){return this.is("input")&&"checkbox"===this.ori.type}isRadio(){return this.is("input")&&"radio"===this.ori.type}isChecked(){return this.ori.checked}tag(){return this.ori.tagName.toLowerCase()}count(){return this.ori.childElementCount}find(e){const t=this.ori.querySelector(e);if(null!=t)return new StormElement(t)}findAll(e){const t=[];return this.ori.querySelectorAll(e).forEach(e=>{t.push(new StormElement(e))}),t}index(){const e=this.parent();return null==e?-1:Array.from(e.ori.children).indexOf(this.ori)}remove(){this.ori.remove()}closest(e){return new StormElement(this.ori.closest(e))}parent(){return new StormElement(this.ori.parentElement)}prev(){return this.ori.previousElementSibling?new StormElement(this.ori.previousElementSibling):null}next(){return this.ori.nextElementSibling?new StormElement(this.ori.nextElementSibling):null}setHtml(e){this.ori.innerHTML=e}append(e){return this.ori.append(e),this}appendHtml(e){const t=document.createRange().createContextualFragment(e);let n=StormComponentFinder.find(t);StormComponentInstantiator.instantiateAll(n),this.ori.append(t)}}class StormEvent{constructor(e){this.ori=e}stop(){this.ori.stopPropagation()}target(){return new StormElement(this.ori.target)}preventDefault(){this.ori.preventDefault()}preventWhenKeyIsPressed(e){this.ori.keyCode===e&&this.ori.preventDefault()}preventWhenKeysArePressed(){for(const e of arguments)this.preventWhenKeyIsPressed(e)}isKeyPressed(e){return"string"==typeof e?this.ori.key===e:this.ori.keyCode===e}hasFiles(){return this.ori.target.files.length>0}getFile(e){return this.ori.target.files[e]}}class StormExpression{static evaluate(e,t){let n=StormTokenizer.tokenize(e);return evaluate(new StormParser(n).parse(),t)}static getExpressionMembers(e){let t=StormTokenizer.tokenize(e),n=new StormParser(t).parse();return this.collectBaseIdentifiers(n)}static collectBaseIdentifiers(e){const t=[];return function e(n,r){if(n&&"object"==typeof n){if("Identifier"===n.type){const e=r&&"MemberExpression"===r.type&&r.object===n;r&&"MemberExpression"===r.type&&r.property;e||t.push(n.name)}for(const t in n){const r=n[t];r&&"object"==typeof r&&e(r,n)}}}(e,null),[...new Set(t)]}}class StormTokenizer{static tokenize(e){const t=/\s*([A-Za-z_]\w*|\d+|'[^']*'|"[^"]*"|==|!=|>=|<=|&&|\|\||[=><().])\s*/g;let n,r=[];for(;null!==(n=t.exec(e));)r.push(n[1]);return r}}class StormParser{i=0;tokens=[];constructor(e){this.tokens=e}peek(){return this.tokens[this.i]}consume(){return this.tokens[this.i++]}parse(){return this.parseExpression()}parseExpression(){return this.parseOr()}parseOr(){let e=this.parseAnd();for(;"||"===this.peek();){e={type:"LogicalExpression",operator:this.consume(),left:e,right:this.parseAnd()}}return e}parseAnd(){let e=this.parseComparison();for(;"&&"===this.peek();){e={type:"LogicalExpression",operator:this.consume(),left:e,right:this.parseComparison()}}return e}parseComparison(){let e=this.parseMember();for(;["==","!=",">","<",">=","<=","="].includes(this.peek());){e={type:"BinaryExpression",operator:this.consume(),left:e,right:this.parseMember()}}return e}parseMember(){let e=this.parsePrimary();for(;"."===this.peek();){this.consume(),e={type:"MemberExpression",object:e,property:{type:"Identifier",name:this.consume()}}}return e}parsePrimary(){let e=this.consume();if("("===e){let e=this.parseExpression();if(")"!==this.peek())throw new Error("Missing closing parenthesis");return this.consume(),e}return/^\d+$/.test(e)?{type:"Literal",value:Number(e)}:/^'.*'$|^".*"$/.test(e)?{type:"Literal",value:e.slice(1,-1)}:"true"===e?{type:"Literal",value:!0}:"false"===e?{type:"Literal",value:!1}:{type:"Identifier",name:e}}}function evaluate(e,t){switch(e.type){case"Literal":return e.value;case"Identifier":return t[e.name];case"MemberExpression":{let n=evaluate(e.object,t);return n?.[e.property.name]}case"BinaryExpression":{let n=evaluate(e.left,t),r=evaluate(e.right,t);switch(e.operator){case"==":return n==r;case"!=":return n!=r;case">":return n>r;case"<":return n<r;case">=":return n>=r;case"<=":return n<=r;case"=":if("MemberExpression"===e.left.type){return evaluate(e.left.object,t)[e.left.property.name]=r,r}throw new Error("Invalid assignment")}}case"LogicalExpression":if("&&"===e.operator)return evaluate(e.left,t)&&evaluate(e.right,t);if("||"===e.operator)return evaluate(e.left,t)||evaluate(e.right,t)}}class WatchList{addCallback=[];deleteCallback=[];items=[];constructor(e){e instanceof Array&&this.addAll(e)}add(e){this.items.push(e),this.addCallback.forEach(t=>{t(e)})}addAll(e){for(let t of e)this.add(t)}delete(e){if("function"!=typeof e)throw new Error("Callback is not function");let t=[];for(let n of this.items)e(n)&&t.push(n);for(let e of t){let t=this.items.indexOf(e);-1!==t&&(this.items.splice(t,1),this.deleteCallback.forEach(t=>t(e)))}}find(e){if("function"!=typeof e)throw new Error("Callback is not function");return this.items.filter(e)}count(e){return"function"!=typeof e?this.items.length:this.items.filter(e).length}onAdd(e){this.addCallback.push(e)}onDelete(e){this.deleteCallback.push(e)}*[Symbol.iterator](){for(let e of this.items)yield e}}class Mounter{static mount(e){if(null==e)return;e.init&&e.init();let t=StormComponentFinder.findAttributes(e.element);StormElementHandler.handle(e,t),this.installChildComponents(e),this.#t(e,e.element),e.initialized&&e.initialized()}static mountComponentElement(e,t){if(null==e)return;let n=StormComponentFinder.findAttributes(t);StormElementHandler.handle(e,n),this.installChildComponents(e),this.#t(e,t)}static installChildComponents(e){let t=StormComponentFinder.find(e);StormComponentInstantiator.instantiateChildComponent(e,t)}static#t(e,t){for(let n of $.plugins)n(e,t)}}class StormElementHandler{static handlers=[];static handle(e,t){for(const n of t)for(const t of this.handlers)t.handle(e,n)}}class AttributeHandler{handle(e,t){}}class CheckedHandler extends AttributeHandler{handle(e,t){if(!t.hasAttribute("x-checked"))return;const n=t.getAttribute("x-checked");t.addEventListener("change",r=>{t.isCheckbox()&&(e[n]=r.ori.target.checked),t.isRadio()&&(e[n]=r.ori.target.value)}),e.bindings.on(n,()=>{this.onAction(e,t,n)}),this.onAction(e,t,n),t.removeAttribute("x-checked")}onAction(e,t,n){let r=e[n];t.isCheckbox()&&t.setAttribute("checked","1"===r||"on"===r||"true"===r||!0===r),t.isRadio()&&r===t.getValue()&&t.setAttribute("checked",!0)}}StormElementHandler.handlers.push(new CheckedHandler);class ClassHandler extends AttributeHandler{handle(e,t){if(!t.hasAttribute("x-class"))return;const n=t.getAttribute("x-class");let r=this.getClassConditions(n);for(let n of r){this.evaluate(e,t,n.expression,n.className);let r=StormExpression.getExpressionMembers(n.expression);for(let i of r)e.bindings.on(i,()=>{this.evaluate(e,t,n.expression,n.className)})}t.removeAttribute("x-class")}evaluate(e,t,n,r){!0===StormExpression.evaluate(n,e)?t.addClass(r):t.removeClass(r)}getClassConditions(e){let t=[],n=e.split(",");for(let e of n){let[n,r]=e.split(":");if(!n||!r)throw new Error(`Invalid class expression ${e}'`);n=n.trim(),r=r.trim(),t.push({expression:n,className:r})}return t}}StormElementHandler.handlers.push(new ClassHandler);class ConditionalHandler extends AttributeHandler{handle(e,t){if(t.hasAttribute("x-if")){const n=t.getAttribute("x-if");this.onIfChangeAction(e,t,n);for(let r of StormExpression.getExpressionMembers(n))e.bindings.on(r,()=>{this.onIfChangeAction(e,t,n)})}t.removeAttribute("x-if")}onIfChangeAction(e,t,n){const r=StormExpression.evaluate(n,e);r||t.hide(),r&&t.show()}}StormElementHandler.handlers.push(new ConditionalHandler);class EnterPressedHandler extends AttributeHandler{attributeName="x-enter-pressed";handle(e,t){if(!t.hasAttribute(this.attributeName))return;const n=t.getAttribute(this.attributeName);if(void 0!==e[n])t.addEventListener("keydown",r=>{13===r.ori.keyCode&&(r.source=t,e[n](r))});else{const t=e.constructor.name;console.error(`Component '${t}' doesn't have '${n}' callback.`)}}}StormElementHandler.handlers.push(new EnterPressedHandler);class GenericEventHandler extends AttributeHandler{events=["abort","after-print","animation-end","animation-iteration","animation-start","before-print","before-unload","blur","can-play","can-play-through","change","click","context-menu","copy","cut","dblclick","drag","drag-end","drag-enter","drag-leave","drag-over","drag-start","drop","durationchange","ended","error","focus","focusin","focusout","fullscreenchange","fullscreenerror","hashchange","input","key-down","key-up","load","loadeddata","loadedmetadata","loadstart","message","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","mousewheel","offline","online","open","pagehide","pageshow","paste","pause","play","playing","popstate","progress","ratechange","reset","resize","scroll","search","seeked","seeking","select","show","stalled","storage","submit","suspend","timeupdate","toggle","touchcancel","touchend","touchmove","touchstart","transitionend","unload","volumechange","waiting","wheel"];handle(e,t){for(const n of this.events){const r="x-"+n;if(t.hasAttribute(r)){const i=t.getAttribute(r);if(void 0!==e[i])t.addEventListener(this.toHtmlEventName(n),n=>{n.source=t,e[i](n)});else{const t=e.componentName;console.error(`Component '${t}' doesn't have '${i}' callback.`)}t.removeAttribute(r)}}}toHtmlEventName(e){return e.split("-").join("")}}StormElementHandler.handlers.push(new GenericEventHandler);class ListHandler extends AttributeHandler{attributeName="x-list";handle(e,t){if(!t.hasAttribute(this.attributeName))return;const n=t.getAttribute(this.attributeName),r=e[n];void 0!==r&&(this.displayList(e,t,r),r.onAdd(n=>this.displayItem(e,t,n)),r.onDelete(e=>this.deleteItem(e))),t.removeAttribute(this.attributeName)}displayList(e,t,n){for(let r of n)this.displayItem(e,t,r)}displayItem(e,t,n){e.appendTo(t,n)}deleteItem(e){e.element.remove()}}StormElementHandler.handlers.push(new ListHandler);