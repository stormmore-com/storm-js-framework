function $(...t){if(!(this instanceof $)){if(t[0]instanceof Array&&1===t.length){for(let e of t[0])$.add(e);return}let e=t[0],n=e.name;if(void 0!==$.components[n])return $.new(...t);$.add(e)}}function Component(t){this.templateName=t}$.mode="prod",$.plugins=[],$.components={},$.getCookie=function(t){let e=t+"=",n=document.cookie.split(";");for(let t=0;t<n.length;t++){let i=n[t];for(;" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(e))return i.substring(e.length,i.length)}return null},$.getFromOptional=function(t,e,n){return null!=e&&void 0!==e[t]?e[t]:n},$.app=function(){const t=StormComponentFinder.find();StormComponentInstantiator.instantiateAll(t)},$.addPlugin=function(t){this.plugins.push(t)},$.new=function(...t){let e=t[0];if(e instanceof Function&&(e=e.name),this.components[e])try{let n=new StormComponent;return n=new Proxy(n,n),t.shift(),t.unshift(n),new $.components[e](...t),n.templateName=e,n.componentName=e,n}catch(t){return console.error(`Can't instantiate component '${name}'.`),null}else console.error("Component '"+e+"' not found!. Did you forget to register it ?")},$.newWithElement=function(t,e){if(!this.components[t])return void console.error("Component '"+t+"' not found!. Did you forget to register it ?");let n=new StormComponent;return n.element=e,n=new Proxy(n,n),new $.components[t](n),n.templateName=t,n.componentName=t,n},$.add=function(t){let e=t.name;$.components[e]=t},document.addEventListener("DOMContentLoaded",function(){$(Component),$.app()});class StormComponent{static eventBindings={};toHtmlBindings={};fromHtmlBindings={};componentName;templateName;constructor(t,e){this.componentName=t,this.templateName=e}set(t,e,n,i){let r=Reflect.set(...arguments);if(this[e]=n,this.toHtmlBindings.hasOwnProperty(e))for(const t of this.toHtmlBindings[e])t.action(this,t.element,e,t.attributeValue);return r}get(t,e,n){return Reflect.get(t,e,n)}setElement(t){this.element=t instanceof StormElement?t:new StormElement(t)}isOnViewport(){const t=this.element.ori.getBoundingClientRect().top;return t>=0&&t<=window.innerHeight}onViewport(t){null==this._viewPortEvent&&(this._viewPortEvent={triggered:!1,stop(){this.triggered=!0},resume(){this.triggered=!1}}),this.isOnViewport()&&!this._viewPortEvent.triggered&&t(this._viewPortEvent),window.addEventListener("scroll",()=>{this.isOnViewport()&&!this._viewPortEvent.triggered&&t(this._viewPortEvent)})}scrollToHash(){location.hash&&this.scrollToId(location.hash.replace("#",""))}scrollToId(t){const e=document.getElementById(t);null!=e&&window.scrollTo(0,e.getBoundingClientRect().top)}onScroll(t,e=0){window.addEventListener("scroll",n=>{e>0?(this._onScrollTimeout&&clearTimeout(this._onScrollTimeout),this._onScrollTimeout=setTimeout(t,e)):t(n)})}onScrollEnd(t,e=50){null==this._scrollEndEvent&&(this._scrollEndEvent={notify:!0,stop(){this.notify=!1},resume(){this.notify=!0}}),window.addEventListener("scroll",()=>{window.innerHeight+window.scrollY>=document.body.scrollHeight-e&&this._scrollEndEvent.notify&&t(this._scrollEndEvent)})}reload(){location.reload()}exist(t){return null!=this.find(t)}findAll(t){return StormComponentFinder.findAttributes(this.element,t)}document(){return new StormElement(document)}find(t){return this.element.find(t)}remove(){this.element.ori.remove()}submit(t=null){return null==t&&(t=this.getFormData()),fetch(t.action,{method:t.method,body:t.data})}addToBinding(t,e,n,i){this.toHtmlBindings.hasOwnProperty(t)||(this.toHtmlBindings[t]=[]),this.toHtmlBindings[t].push({element:n,attributeValue:e,action:i})}broadcastHtmlBindings(t,e){if(this.toHtmlBindings.hasOwnProperty(t))for(const n of this.toHtmlBindings[t])n.element.ori!=e.ori&&n.element.setValue(e.getValue())}emit(t,e){if(StormComponent.eventBindings[t])for(let n of StormComponent.eventBindings[t])n(e)}on(t,e){StormComponent.eventBindings.hasOwnProperty(t)||(StormComponent.eventBindings[t]=[]),StormComponent.eventBindings[t].push(e)}removeChildren(){this.element.ori.innerHTML=""}appendHtml(t){this.element.appendHtml(t)}append(t){this.appendTo(this.element.ori,t)}appendTo(t,e){if(e.template){let n=document.createElement("template");n.innerHTML=e.template.trim(),n=n.content.firstElementChild,e.setElement(n),Mounter.mount(e),t.append(e.element.ori)}else{const n=e.templateName;this.loadTemplateDocFragment(n).then(n=>{e.setElement(n),Mounter.mount(e),t.append(e.element.ori)}).catch(t=>{console.error(t)})}}showTemplate(){let t=this.element.find("template");if(t){let e=new StormElement(t.ori.content.cloneNode(!0));this.removeChildren(),Mounter.mountComponentElement(this,e),this.element.ori.append(e.ori)}}loadTemplateDocFragment(t){return new Promise((e,n)=>{const i=document.querySelector("[x-for="+t+"]");null==i&&n(`Template '${t}' not found.`);i.content.cloneNode(!0);if(1===i.content.children.length)e(i.content.children[0].cloneNode(!0));else{const t=document.createElement("div");for(let e of i.content.children)t.appendChild(e.cloneNode(!0));e(t)}})}}class StormComponentFinder{static find(t=null){let e=t;null==e&&(e=document.body),null!=t&&null!=t.element&&null!=t.element.ori&&(e=t.element.ori),t instanceof StormElement&&(e=t.ori);let n=Array.from(e.querySelectorAll("*")).filter(t=>t.tagName.toLowerCase().startsWith("x-")).filter(t=>{let n=this.closestStormComponent(t);return(null==n||n==e)&&null==t.closest("template")});return Array.from(n,t=>new StormElement(t))}static findAttributes(t,e="*"){let n=Array.from(t.ori.querySelectorAll(e)).filter(t=>this.#t(t)).filter(e=>{const n=this.closestStormComponent(e);return(null==n||n==t.ori)&&null==e.closest("template")});return this.#t(t.ori)&&n.push(t.ori),Array.from(n,t=>new StormElement(t))}static#t(t){return null!=t.attributes&&Array.from(t.attributes).filter(({name:t})=>t.startsWith("x-")).length}static closestStormComponent(t){let e=t.parentElement;for(;e;){if(e.tagName.toLowerCase().startsWith("x-"))return e;e=e.parentElement}return null}}class StormComponentInstantiator{static instantiateAll(t){for(let e of t){const t=this.instantiate(e);Mounter.mount(t)}}static instantiateChildComponent(t,e){for(let n of e){let e,i=t[StormComponentName.getComponentPropertyName(n)];i?(e=i,e.element=n):e=this.instantiate(n),Mounter.mount(e)}}static instantiate(t){let e=StormComponentName.getComponentName(t),n=$.newWithElement(e,t),i=t.getAttribute("x-init");if(i){let e=JSON.parse(i);for(let[t,i]of Object.entries(e))n[t]=i;t.removeAttribute("x-init")}return n.element=t,n}}class StormComponentName{static getComponentName(t){let e=t.ori.tagName.toLowerCase().split("-").slice(1);return e.forEach((t,n)=>{e[n]=e[n].charAt(0).toUpperCase()+e[n].slice(1)}),e.join("")}static getComponentPropertyName(t){let e=this.getComponentName(t);return e.charAt(0).toLowerCase()+e.slice(1)}static getComponentTagName(t){let e=t.constructor.name,n="";for(let t=0;t<e.length;t++)e.charAt(t)===e.charAt(t).toUpperCase()?(t>0&&(n+="-"),n+=e.charAt(t).toLowerCase()):n+=e.charAt(t);return n}static getTagName(t){return"x-"+this.getComponentTagName(t)}}class StormElement{constructor(t){this.ori=t}id(){return this.ori.id}href(){return this.is("a")?this.ori.getAttribute("href"):this.ori.getAttribute("x-href")}redirect(){window.location=this.href()}disable(){this.ori.disabled=!0}enable(){this.ori.disabled=!1}hasAttribute(t){return this.ori.hasAttribute(t)}getAttribute(t){return this.ori.getAttribute(t)}setAttribute(t,e){"checked"===t.toLowerCase()?this.ori.checked=!0===e:this.ori.setAttribute(t,e)}removeAttribute(t){return this.ori.removeAttribute(t)}addClass(t){return this.ori.classList.add(t),this}hasClass(t){return this.ori.classList.contains(t)}removeClass(t){return this.ori.classList.remove(t),this}on(t,e){this.addEventListener(t,e)}addEventListener(t,e){return this.ori.addEventListener(t,t=>{e(new StormEvent(t),this)}),this}addEventListenerOn(t,e,n){const i=this.find(e);return null==i||i.addEventListener(t,n),this}addEventListenerOnAll(t,e,n){return this.findAll(e).forEach(e=>{e.addEventListener(t,n)}),this}loaded(t){return this.ori.complete?t():this.addEventListener("load",t),this}focus(){return this.ori.focus(),this}isFocused(){return this.ori==document.activeElement}setEditable(t){this.ori.contentEditable=t}scrollCenter(){return this.ori.scrollIntoView({block:"center"}),this}scrollTop(t=0){const e=this.ori.offsetTop;return window.scrollTo(0,e+t),this}removeStyleProperty(t){this.ori.style.removeProperty(t)}setMinWidth(t,e="px"){this.ori.style.minWidth=t+e}setWidth(t,e="px"){return this.ori.style.width=t+e,this}setMinHeight(t,e="px"){this.ori.style.minHeight=t+e}setHeight(t,e="px"){return this.ori.style.height=t+e,this}setHeightToScroll(){this.ori.style.height="auto",this.ori.style.height=this.ori.scrollHeight+"px"}submit(){this.ori.submit()}getWidth(){return this.ori.offsetWidth}getHeight(){return this.ori.offsetHeight}getScrollHeight(){return this.ori.scrollHeight}show(t=!0){return t?this.ori.style.removeProperty("display"):this.hide(),this}hide(){this.ori.style.display="none"}formData(){return new FormData(this.ori)}getAction(){return this.ori.getAttribute("action")}getMethod(){return this.ori.getAttribute("method")}serialize(){return{action:this.getAction(),method:this.getMethod(),data:this.formData()}}clear(){const t=this.ori.tagName.toLowerCase();return"input"!==t&&"textarea"!==t||(this.ori.value=""),"img"===t?this.ori.setAttribute("src",""):this.ori.innerHTML="",this}setValue(t){const e=this.ori.tagName.toLowerCase();return"input"!==e&&"textarea"!==e||(this.ori.value=t),"img"===e?this.ori.setAttribute("src",t):this.ori.innerText=t,this}getValue(){const t=this.ori.tagName.toLowerCase();return"input"===t||"textarea"===t?this.ori.value:"img"===t?this.ori.getAttribute("src"):this.ori.innerText.trim()}is(t){if("string"==typeof t&&this.ori.tagName.toLowerCase()===t.toLowerCase())return!0}isCheckbox(){return this.is("input")&&"checkbox"===this.ori.type}isRadio(){return this.is("input")&&"radio"===this.ori.type}isChecked(){return this.ori.checked}tag(){return this.ori.tagName.toLowerCase()}count(){return this.ori.childElementCount}find(t){const e=this.ori.querySelector(t);if(null!=e)return new StormElement(e)}findAll(t){const e=[];return this.ori.querySelectorAll(t).forEach(t=>{e.push(new StormElement(t))}),e}index(){const t=this.parent();return null==t?-1:Array.from(t.ori.children).indexOf(this.ori)}remove(){this.ori.remove()}closest(t){return new StormElement(this.ori.closest(t))}parent(){return new StormElement(this.ori.parentElement)}prev(){return this.ori.previousElementSibling?new StormElement(this.ori.previousElementSibling):null}next(){return this.ori.nextElementSibling?new StormElement(this.ori.nextElementSibling):null}setHtml(t){this.ori.innerHTML=t}append(t){return this.ori.append(t),this}appendHtml(t){const e=document.createRange().createContextualFragment(t);let n=StormComponentFinder.find(e);StormComponentInstantiator.instantiateAll(n),this.ori.append(e)}}class StormEvent{constructor(t){this.ori=t}stop(){this.ori.stopPropagation()}target(){return new StormElement(this.ori.target)}preventDefault(){this.ori.preventDefault()}preventWhenKeyIsPressed(t){this.ori.keyCode===t&&this.ori.preventDefault()}preventWhenKeysArePressed(){for(const t of arguments)this.preventWhenKeyIsPressed(t)}isKeyPressed(t){return"string"==typeof t?this.ori.key===t:this.ori.keyCode===t}hasFiles(){return this.ori.target.files.length>0}getFile(t){return this.ori.target.files[t]}}class WatchList{addCallback=[];deleteCallback=[];items=[];constructor(t){t instanceof Array&&this.addAll(t)}add(t){this.items.push(t),this.length++,this.addCallback.forEach(e=>{e(t)})}addAll(t){for(let e of t)this.add(e)}delete(t){if("function"!=typeof t)throw new Error("Callback is not function");let e=[];for(let n of this.items)t(n)&&e.push(n);for(let t of e){let e=this.items.indexOf(t);-1!==e&&(this.items.splice(e,1),this.deleteCallback.forEach(e=>e(t)))}}find(t){if("function"!=typeof t)throw new Error("Callback is not function");return this.items.filter(t)}count(t){return"function"!=typeof t?this.items.length:this.items.filter(t).length}onAdd(t){this.addCallback.push(t)}onDelete(t){this.deleteCallback.push(t)}*[Symbol.iterator](){for(let t of this.items)yield t}}class AttributePropertyValuesMap{data={};addProperty(t){this.data[t]=[]}getFirstProperty(){const t=this.getProperties();return t.length>0?t[0]:null}getProperties(){return Object.keys(this.data)}addPropertyValues(t,e){this.data[t]=e}getPropertyValues(t){return this.data[t]}getPropertyValue(t,e=null){const n=this.getPropertyValues(t);return null!=n&&n.length>0?n[0]:e}}class AttributePropertyValuesParser{static getMap(t){let e=new AttributePropertyValuesMap;const n=t.split(";");for(const t of n){const n=t.split(":"),i=n[0];e.addProperty(i),n.length>1&&e.addPropertyValues(i,n[1].split(","))}return e}}class Mounter{static mount(t){if(null==t)return;t.init&&t.init();let e=StormComponentFinder.findAttributes(t.element);StormElementHandler.handle(t,e),this.installChildComponents(t),this.#e(t,t.element),t.initialized&&t.initialized()}static mountComponentElement(t,e){if(null==t)return;let n=StormComponentFinder.findAttributes(e);StormElementHandler.handle(t,n),this.installChildComponents(t),this.#e(t,e)}static installChildComponents(t){let e=StormComponentFinder.find(t);StormComponentInstantiator.instantiateChildComponent(t,e)}static#e(t,e){for(let n of $.plugins)n(t,e)}}class StormElementHandler{static handlers=[];static handle(t,e){for(const n of e)for(const e of this.handlers)e.handle(t,n)}}class AttributeHandler{handle(t,e){}}class CheckedHandler extends AttributeHandler{handle(t,e){if(!e.hasAttribute("x-checked"))return;const n=e.getAttribute("x-checked");e.addEventListener("change",i=>{e.isCheckbox()&&(t[n]=i.ori.target.checked),e.isRadio()&&(t[n]=i.ori.target.value)}),t.addToBinding(n,n,e,this.onAction),this.onAction(t,e,n),e.removeAttribute("x-checked")}onAction(t,e,n){let i=t[n];e.isCheckbox()&&e.setAttribute("checked","1"===i||"on"===i||"true"===i||!0===i),e.isRadio()&&i===e.getValue()&&e.setAttribute("checked",!0)}}StormElementHandler.handlers.push(new CheckedHandler);class ClassHandler extends AttributeHandler{handle(t,e){if(!e.hasAttribute("x-class"))return;const n=e.getAttribute("x-class"),i=AttributePropertyValuesParser.getMap(n);for(const r of i.getProperties())this.onAction(t,e,r,n),t.addToBinding(r,n,e,this.onAction);e.removeAttribute("x-class")}onAction(t,e,n,i){const r=t[n],o=AttributePropertyValuesParser.getMap(i).getPropertyValues(n);r&&e.addClass(o),r||e.removeClass(o)}}StormElementHandler.handlers.push(new ClassHandler);class ConditionalHandler extends AttributeHandler{handle(t,e){if(e.hasAttribute("x-if")){const n=e.getAttribute("x-if");this.onIfChangeAction(t,e,n),t.addToBinding(n,n,e,this.onIfChangeAction)}if(e.hasAttribute("x-if-not")){const n=e.getAttribute("x-if-not");this.onIfNotAction(t,e,n),t.addToBinding(n,n,e,this.onIfNotAction)}e.removeAttribute("x-if"),e.removeAttribute("x-if-not")}onIfChangeAction(t,e,n){const i=t[n];i||e.hide(),i&&e.show()}onIfNotAction(t,e,n){const i=t[n];i||e.show(),i&&e.hide()}}StormElementHandler.handlers.push(new ConditionalHandler);class EnterPressedHandler extends AttributeHandler{attributeName="x-enter-pressed";handle(t,e){if(!e.hasAttribute(this.attributeName))return;const n=e.getAttribute(this.attributeName);if(void 0!==t[n])e.addEventListener("keydown",i=>{13===i.ori.keyCode&&(i.source=e,t[n](i))});else{const e=t.constructor.name;console.error(`Component '${e}' doesn't have '${n}' callback.`)}}}StormElementHandler.handlers.push(new EnterPressedHandler);class GenericEventHandler extends AttributeHandler{events=["abort","after-print","animation-end","animation-iteration","animation-start","before-print","before-unload","blur","can-play","can-play-through","change","click","context-menu","copy","cut","dblclick","drag","drag-end","drag-enter","drag-leave","drag-over","drag-start","drop","durationchange","ended","error","focus","focusin","focusout","fullscreenchange","fullscreenerror","hashchange","input","key-down","key-up","load","loadeddata","loadedmetadata","loadstart","message","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","mousewheel","offline","online","open","pagehide","pageshow","paste","pause","play","playing","popstate","progress","ratechange","reset","resize","scroll","search","seeked","seeking","select","show","stalled","storage","submit","suspend","timeupdate","toggle","touchcancel","touchend","touchmove","touchstart","transitionend","unload","volumechange","waiting","wheel"];handle(t,e){for(const n of this.events){const i="x-"+n;if(e.hasAttribute(i)){const r=e.getAttribute(i);if(void 0!==t[r])e.addEventListener(this.toHtmlEventName(n),n=>{n.source=e,t[r](n)});else{const e=t.componentName;console.error(`Component '${e}' doesn't have '${r}' callback.`)}e.removeAttribute(i)}}}toHtmlEventName(t){return t.split("-").join("")}}StormElementHandler.handlers.push(new GenericEventHandler);class ListHandler extends AttributeHandler{attributeName="x-list";handle(t,e){if(!e.hasAttribute(this.attributeName))return;const n=e.getAttribute(this.attributeName),i=t[n];void 0!==i&&(this.displayList(t,e,i),i.onAdd(n=>this.displayItem(t,e,n)),i.onDelete(t=>this.deleteItem(t))),e.removeAttribute(this.attributeName)}displayList(t,e,n){for(let i of n)this.displayItem(t,e,i)}displayItem(t,e,n){t.appendTo(e,n)}deleteItem(t){t.element.remove()}}StormElementHandler.handlers.push(new ListHandler);class PropHandler{propAttributeName="x-prop";propUpAttributeName="x-prop-up";propElAttributeName="x-prop-element";handle(t,e){if(e.hasAttribute(this.propAttributeName)){const n=e.getAttribute(this.propAttributeName);this.onAction(t,e,n),t.addToBinding(n,n,e,this.onAction),this.onKeyDown(t,e,n),e.removeAttribute(this.propAttributeName)}if(e.hasAttribute(this.propUpAttributeName)){const n=e.getAttribute(this.propUpAttributeName);let i=e.getValue();isNaN(i)||(i=Number(i)),t[n]=i,t.broadcastHtmlBindings(n,e),t.addToBinding(n,n,e,this.onAction),this.onKeyDown(t,e,n),e.removeAttribute(this.propUpAttributeName)}if(e.hasAttribute(this.propElAttributeName)){t[e.getAttribute(this.propElAttributeName)]=e,e.removeAttribute(this.propElAttributeName)}}onKeyDown(t,e,n){e.addEventListener("keyup",()=>{t[n]=e.getValue(),t.broadcastHtmlBindings(n,e)})}onAction(t,e,n){const i=t[n];if(void 0!==i)if(i instanceof Array)for(const n of i)t.appendTo(e.ori,n);else e.setValue(i)}}StormElementHandler.handlers.push(new PropHandler);